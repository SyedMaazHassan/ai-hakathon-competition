{% extends "core/new_base.html" %}
{% load static %}

{% block title %}Jobs | Hire With AI{% endblock %}
{% block current_page %}Jobs{% endblock %}
{% block page_title %}Jobs{% endblock %}
{% block page_subtitle %}Manage and track all job postings{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto" x-data="jobListApp()" x-init="init()">
  <!-- Enhanced Header with Search and Filters -->
  <div class="space-y-4 mb-6">
    <!-- Top Row: Title and Actions -->
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">Job Listings</h2>
        <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">
          Manage and track all job postings
        </p>
      </div>
      <div class="flex gap-2">
        <button class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
            <polyline points="7 10 12 15 17 10"/>
            <line x1="12" x2="12" y1="15" y2="3"/>
          </svg>
          Export
        </button>
        <a href="{% url 'jobs:job_create' %}" class="inline-flex items-center px-3 py-2 bg-orange-600 hover:bg-orange-700 text-white rounded-md text-sm font-medium">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M5 12h14"/>
            <path d="M12 5v14"/>
          </svg>
          Add Job
        </a>
      </div>
    </div>

    <!-- Search and Filters Row -->
    <div class="flex flex-col lg:flex-row gap-4">
      <div class="relative flex-1 max-w-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/>
          <path d="m21 21-4.3-4.3"/>
        </svg>
        <input
          type="text"
          x-model="searchTerm"
          placeholder="Search jobs by title, company, or location..."
          class="w-full h-9 pl-10 pr-3 rounded-md border border-gray-300 dark:border-dark-border bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500"
        />
      </div>

      <div class="flex gap-2">
        <!-- Employment Type Filter -->
        <div class="relative" x-data="{ open: false }">
          <button
            @click="open = !open"
            class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md text-sm font-medium text-gray-700 dark:text-dark-text bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-dark-hover"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
            </svg>
            <span x-text="selectedFilter === 'all' ? 'All Types' : selectedFilter.replace('_', ' ')"></span>
          </button>
          <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-2 w-48 bg-white dark:bg-dark-card border border-gray-200 dark:border-dark-border rounded-md shadow-lg z-10">
            <div class="py-1">
              <button @click="selectedFilter = 'all'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">All Types</button>
              <button @click="selectedFilter = 'full_time'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Full Time</button>
              <button @click="selectedFilter = 'part_time'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Part Time</button>
              <button @click="selectedFilter = 'contract'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Contract</button>
              <button @click="selectedFilter = 'freelance'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Freelance</button>
            </div>
          </div>
        </div>

        <!-- Seniority Filter -->
        <div class="relative" x-data="{ open: false }">
          <button
            @click="open = !open"
            class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md text-sm font-medium text-gray-700 dark:text-dark-text bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-dark-hover"
          >
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
            </svg>
            <span x-text="seniorityFilter === 'all' ? 'All Levels' : seniorityFilter"></span>
          </button>
          <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-2 w-48 bg-white dark:bg-dark-card border border-gray-200 dark:border-dark-border rounded-md shadow-lg z-10">
            <div class="py-1">
              <button @click="seniorityFilter = 'all'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">All Levels</button>
              <button @click="seniorityFilter = 'entry'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Entry Level</button>
              <button @click="seniorityFilter = 'mid'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Mid Level</button>
              <button @click="seniorityFilter = 'senior'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Senior Level</button>
              <button @click="seniorityFilter = 'lead'; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">Lead Level</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Results Summary -->
    <div class="flex items-center justify-between text-sm">
      <span class="text-gray-600 dark:text-gray-400">
        Showing <span x-text="startIndex + 1"></span>-<span x-text="Math.min(startIndex + itemsPerPage, filteredJobs.length)"></span> of <span x-text="filteredJobs.length"></span> jobs
      </span>
      <div class="flex items-center gap-2">
        <span class="text-gray-600 dark:text-gray-400">Show:</span>
        <div class="relative" x-data="{ open: false }">
          <button @click="open = !open" class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-dark-border rounded-md text-sm font-medium text-gray-700 dark:text-dark-text bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-dark-hover">
            <span x-text="itemsPerPage"></span>
          </button>
          <div x-show="open" @click.away="open = false" x-transition class="absolute right-0 mt-2 w-20 bg-white dark:bg-dark-card border border-gray-200 dark:border-dark-border rounded-md shadow-lg z-10">
            <div class="py-1">
              <button @click="itemsPerPage = 10; currentPage = 1; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">10</button>
              <button @click="itemsPerPage = 25; currentPage = 1; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">25</button>
              <button @click="itemsPerPage = 50; currentPage = 1; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">50</button>
              <button @click="itemsPerPage = 100; currentPage = 1; open = false" class="block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">100</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Jobs Table -->
  <div class="bg-white dark:bg-dark-card border border-gray-200 dark:border-dark-border rounded-lg shadow-sm">
    <div class="overflow-x-auto">
      <table class="w-full">
        <thead>
          <tr class="border-b border-gray-200 dark:border-dark-border bg-gray-50 dark:bg-dark-hover">
            <th class="w-[300px] px-6 py-3 text-left">
              <button
                @click="handleSort('title')"
                class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-dark-text"
              >
                Job Details
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"/>
                  <path d="M7 12h10"/>
                  <path d="M10 18h4"/>
                </svg>
              </button>
            </th>
            <th class="px-6 py-3 text-left">
              <button
                @click="handleSort('company_name')"
                class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-dark-text"
              >
                Company
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"/>
                  <path d="M7 12h10"/>
                  <path d="M10 18h4"/>
                </svg>
              </button>
            </th>
            <th class="px-6 py-3 text-left">
              <button
                @click="handleSort('location_city')"
                class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-dark-text"
              >
                Location
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"/>
                  <path d="M7 12h10"/>
                  <path d="M10 18h4"/>
                </svg>
              </button>
            </th>
            <th class="px-6 py-3 text-left">
              <button
                @click="handleSort('employment_type')"
                class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-dark-text"
              >
                Type
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"/>
                  <path d="M7 12h10"/>
                  <path d="M10 18h4"/>
                </svg>
              </button>
            </th>
            <th class="px-6 py-3 text-left">
              <button
                @click="handleSort('seniority')"
                class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"
              >
                Level
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"/>
                  <path d="M7 12h10"/>
                  <path d="M10 18h4"/>
                </svg>
              </button>
            </th>
            <th class="px-6 py-3 text-left">
              <button
                @click="handleSort('created_at')"
                class="flex items-center gap-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"
              >
                Posted
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M3 6h18"/>
                  <path d="M7 12h10"/>
                  <path d="M10 18h4"/>
                </svg>
              </button>
            </th>
            <th class="px-6 py-3 text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Alpine.js version -->
          <template x-for="job in paginatedJobs" :key="job.id">
            <tr class="border-b border-gray-200 dark:border-dark-border hover:bg-gray-50 dark:hover:bg-dark-hover cursor-pointer transition-colors duration-150" @click="viewJob(job.id)">
              <td class="px-6 py-4">
                <div class="space-y-2">
                  <div class="font-medium text-gray-900 dark:text-dark-text hover:text-orange-600 dark:hover:text-orange-400 transition-colors" x-text="job.title || 'Job Title'"></div>
                  <div class="flex items-center gap-2">
                    <span
                      class="px-2 py-1 text-xs font-medium rounded border"
                      :class="getSeniorityColor(job.seniority)"
                      x-text="job.seniority || 'Unspecified'"
                    ></span>
                    <div x-show="job.parsing_confidence" class="flex items-center gap-1">
                      <div
                        class="h-2 w-2 rounded-full"
                        :class="job.parsing_confidence > 0.8 ? 'bg-green-500' : job.parsing_confidence > 0.6 ? 'bg-yellow-500' : 'bg-red-500'"
                      ></div>
                      <span class="text-xs text-gray-500 dark:text-gray-400" x-text="Math.round(job.parsing_confidence * 100) + '%'"></span>
                    </div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/>
                  </svg>
                  <span class="text-sm text-gray-900 dark:text-dark-text" x-text="job.company_name || 'Company not specified'"></span>
                </div>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500 dark:text-gray-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"/>
                    <circle cx="12" cy="10" r="3"/>
                  </svg>
                  <span class="text-sm text-gray-900 dark:text-dark-text" x-text="getLocationText(job)"></span>
                </div>
              </td>
              <td class="px-6 py-4">
                <span
                  class="px-2 py-1 text-xs font-medium rounded border whitespace-nowrap"
                  :class="getEmploymentTypeColor(job.employment_type)"
                  x-text="job.employment_type ? job.employment_type.replace('_', ' ') : 'Unspecified'"
                ></span>
              </td>
              <td class="px-6 py-4">
                <span
                  class="px-2 py-1 text-xs font-medium rounded border"
                  :class="getSeniorityColor(job.seniority)"
                  x-text="job.seniority || 'Unspecified'"
                ></span>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-gray-500 dark:text-gray-400" x-text="formatDate(job.created_at)"></div>
              </td>
              <td class="px-6 py-4 text-right">
                <div class="dropdown-container" x-data="{ open: false }" @click.outside="open = false">
                  <button
                    @click.stop="open = !open"
                    class="dropdown-trigger"
                    :class="{ 'bg-gray-100 dark:bg-dark-hover': open }"
                  >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <circle cx="12" cy="12" r="1"/>
                      <circle cx="19" cy="12" r="1"/>
                      <circle cx="5" cy="12" r="1"/>
                    </svg>
                  </button>
                  <div x-show="open" x-transition:enter="transition ease-out duration-100" x-transition:enter-start="transform opacity-0 scale-95" x-transition:enter-end="transform opacity-100 scale-100" x-transition:leave="transition ease-in duration-75" x-transition:leave-start="transform opacity-100 scale-100" x-transition:leave-end="transform opacity-0 scale-95" class="dropdown-menu">
                    <button @click="viewJob(job.id); open = false" class="dropdown-item">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                      View Details
                    </button>
                    <button @click="editJob(job.id); open = false" class="dropdown-item">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                      </svg>
                      Edit Job
                    </button>
                    <button @click="deleteJob(job.id); open = false" class="dropdown-item danger">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-3" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3,6 5,6 21,6"/>
                        <path d="M19,6v14a2,2 0 0,1 -2,2H7a2,2 0 0,1 -2,-2V6m3,0V4a2,2 0 0,1 2,-2h4a2,2 0 0,1 2,2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                      </svg>
                      Delete Job
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </template>

          <!-- Empty State -->
          <tr x-show="paginatedJobs.length === 0">
            <td colspan="7" class="px-6 py-12 text-center text-gray-500 dark:text-gray-400">
              <div x-show="filteredJobs.length === 0">
                <div class="text-gray-500 dark:text-gray-400 mb-2">No jobs found matching your criteria.</div>
                <button
                  x-show="searchTerm"
                  @click="searchTerm = ''"
                  class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700"
                >
                  Clear search
                </button>
                <div x-show="!searchTerm" class="mt-4">
                  <a href="{% url 'jobs:job_create' %}" class="text-orange-600 hover:text-orange-700">Create your first job</a>
                </div>
              </div>
              <div x-show="filteredJobs.length > 0">No jobs on this page.</div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Enhanced Pagination -->
  <div x-show="totalPages > 1" class="flex items-center justify-between pt-4 border-t border-gray-200 dark:border-gray-700">
    <div class="text-sm text-gray-500 dark:text-gray-400">
      Page <span x-text="currentPage"></span> of <span x-text="totalPages"></span>
    </div>
    <div class="flex items-center gap-2">
      <button
        @click="handlePageChange(currentPage - 1)"
        :disabled="currentPage === 1"
        class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m15 18-6-6 6-6"/>
        </svg>
        Previous
      </button>

      <!-- Page numbers -->
      <div class="flex gap-1">
        <template x-for="pageNum in getPageNumbers()" :key="pageNum">
          <button
            @click="handlePageChange(pageNum)"
            class="w-8 h-8 p-0 text-sm font-medium rounded"
            :class="currentPage === pageNum ? 'bg-orange-600 text-white' : 'border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700'"
            x-text="pageNum"
          ></button>
        </template>
      </div>

      <button
        @click="handlePageChange(currentPage + 1)"
        :disabled="currentPage === totalPages"
        class="inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Next
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="m9 18 6-6-6-6"/>
        </svg>
      </button>
    </div>
  </div>
</div>

<script>
  // Pass jobs data from Django to JavaScript
  window.jobsData = [
    {% for job in jobs %}
    {
      id: {{ job.id }},
      title: "{{ job.parsed_detailed.title|default:""|escapejs }}",
      company_name: "{{ job.parsed_detailed.company.name|default:""|escapejs }}",
      location_city: "{{ job.parsed_detailed.location_requirements.city|default:""|escapejs }}",
      location_country: "{{ job.parsed_detailed.location_requirements.country|default:""|escapejs }}",
      employment_type: "{{ job.parsed_detailed.employment_type|default:""|escapejs }}",
      seniority: "{{ job.parsed_detailed.seniority|default:""|escapejs }}",
      created_at: "{{ job.created_at|date:"c" }}",
      parsing_confidence: {{ job.parsed_detailed.parsing_confidence|default:"null" }},
      applications_count: {{ job.applications.count }}
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
  ];
</script>
<script src="{% static 'js/jobs_list.js' %}"></script>
{% endblock %}